[gd_scene load_steps=9 format=3 uid="uid://bsv6yt3q1qxg0"]

[ext_resource type="Script" path="res://08_SUBSCENES/Oddity/Scanner/Add_oddity/Oddity_fusion_main.gd" id="1_mnjhy"]
[ext_resource type="Resource" uid="uid://bn75vuf7cte04" path="res://08_SUBSCENES/Oddity/00_Trigger_Effect_data/effect_ressource/scale_up.tres" id="2_43gw3"]
[ext_resource type="Script" path="res://08_SUBSCENES/Oddity/Scanner/Add_oddity/Push_at_start.gd" id="3_ihlmp"]
[ext_resource type="Script" path="res://08_SUBSCENES/Oddity/Scanner/Add_oddity/Fusion_node.gd" id="3_np7bw"]
[ext_resource type="PackedScene" uid="uid://b3e0cgra0jrsb" path="res://08_SUBSCENES/Model/ODDITY/Peon_oddity_v01.blend" id="4_y7eg0"]
[ext_resource type="Material" uid="uid://bw5kv15s072f6" path="res://08_SUBSCENES/02_Fusionnable_elements/Fussionable_element_mat.tres" id="6_3yiek"]

[sub_resource type="GDScript" id="GDScript_uwy51"]
script/source = "extends Node


@export var speed : float
@onready var root = $\"..\"
var move : bool = false

var random_offset : Vector3
var rotation_target : Vector3
@onready var random_range_update = $Random_range_update

var is_paused : bool

func _ready():

	rotation_target = Vector3(randf_range(-90.0,90.0),randf_range(-90.0,90.0),randf_range(-90.0,90.0))
	_global_datas._traceur_pause.connect(_set_paused)	
	
	
	
func _set_paused(condition : bool):
	is_paused = condition	
	
func _process(delta):
	
	if !move:
		return
	if is_paused:
		return
	_folow_Main_Oddity(delta)
	
func _folow_Main_Oddity(delta):
	
	var main_oddity = _global_datas.Main_oddity_node.global_position
	root.global_position = lerp(root.global_position,main_oddity, speed * delta)			
	root.global_rotation = lerp(root.global_rotation,rotation_target, 0.1 * delta)
		

func _on_random_range_update_timeout():
	
	random_offset = Vector3(randf_range(-0.5,0.5),randf_range(-0.5,0.5),0.0)	



"

[sub_resource type="SphereShape3D" id="SphereShape3D_adr80"]
radius = 0.107008

[node name="Organic_oddity_prefab" type="Area3D"]
collision_layer = 4
collision_mask = 4
script = ExtResource("1_mnjhy")
fusion_effect = Array[Resource]([ExtResource("2_43gw3")])

[node name="Push_at_start" type="Node" parent="."]
script = ExtResource("3_ihlmp")

[node name="Fusion_node" type="Node" parent="."]
script = ExtResource("3_np7bw")

[node name="Movable_oddity" type="Node" parent="."]
script = SubResource("GDScript_uwy51")
speed = 2.0

[node name="Random_range_update" type="Timer" parent="Movable_oddity"]
wait_time = 0.25
autostart = true

[node name="col" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_adr80")

[node name="msh_oddity_peon" parent="." instance=ExtResource("4_y7eg0")]
transform = Transform3D(0.024044, 0, 0, 0, 0.024044, 0, 0, 0, 0.024044, 0, 0, 0)

[node name="msh_oddity_peon" parent="msh_oddity_peon" index="0"]
layers = 4
cast_shadow = 0
gi_mode = 0
surface_material_override/0 = ExtResource("6_3yiek")

[connection signal="area_entered" from="." to="Push_at_start" method="_on_organic_oddity_prefab_area_entered"]
[connection signal="push" from="." to="Push_at_start" method="_on_organic_oddity_prefab_push"]
[connection signal="tree_exited" from="." to="." method="_on_tree_exited"]
[connection signal="fusion" from="Fusion_node" to="Fusion_node" method="_on_fusion"]
[connection signal="tree_exited" from="Movable_oddity" to="Movable_oddity" method="_on_tree_exited"]
[connection signal="timeout" from="Movable_oddity/Random_range_update" to="Movable_oddity" method="_on_random_range_update_timeout"]

[editable path="msh_oddity_peon"]
